name: ğŸ‘¤ğŸ–Œï¸ Fix Code Style

# Description: Runs code style fixes or checks, and namespace checks for C# code.
#
# Fields:
# - mode: 'fix' or 'check'
#
# Triggers:
# - Manually via workflow_dispatch with mode input
#
# Permissions:
# - contents:write - Required to create branches and commit changes
permissions:
  contents: write
on:
  workflow_dispatch:
    inputs:
      mode:
        description: 'Mode for code style: fix, check, or soft-check'
        required: true
        default: 'check'
        type: string

jobs:
  header-fixer:
    name: ğŸ§¾ Header Fixer
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11

      - name: Process C# file headers
        uses: ./.github/actions/code-style/header-fixer
        with:
          mode: "${{ github.event.inputs.mode }}"

  trailing-whitespace:
    name: ğŸ§¹ Trailing Whitespace
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11

      - name: Process trailing whitespace
        uses: ./.github/actions/code-style/trailing-whitespace
        with:
          mode: "${{ github.event.inputs.mode }}"

  using-sorter:
    name: ğŸ”€ Using Sorter
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11

      - name: Process using directives
        uses: ./.github/actions/code-style/using-sorter
        with:
          mode: "${{ github.event.inputs.mode }}"

  namespace-check:
    name: ğŸ“‚ Namespaces Check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11

      - name: Run Namespace Fixer
        uses: ./.github/actions/code-style/namespace-fixer
        with:
          mode: "${{ github.event.inputs.mode }}"

  commit-changes:
    name: ğŸ“¦ Commit Code Style Fixes
    needs: [header-fixer, trailing-whitespace, using-sorter, namespace-check]
    if: ${{ github.event.inputs.mode == 'fix' }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11
        with:
          ref: ${{ github.ref }}
      - name: Configure Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
      - name: Commit and Push code style fixes
        run: |
          git add .
          if ! git diff --cached --quiet; then
            git commit -m "chore(ci): apply code style fixes"
            git push
          else
            echo "No changes to commit"
          fi
